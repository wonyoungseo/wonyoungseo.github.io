<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes - Multi-Container Pod | Wonyoung's Tech Blog</title><meta name=keywords content="kubernetes,k8s"><meta name=description content="Multi-Container Pod  (처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님. 그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.  다른 컨테이너를 통해 실행되는 서비스가 메인 어플리케이션을 보조하는 경우 동일 스토리지 또는 네트워크의 공유하는 서비스가 필요한 경우 동일한 라이프사이클을 이루는 경우  생성, 배포, 삭제, 스케일 업다운이 동일하게 적용되어야 하는 경우.   예) 웹서버와 별도로 로깅 서비스가 함께 페어를 이룬 경우   따라서 굳이 별도의 파드에 분리할 필요가 없음."><meta name=author content="Wonyoung Seo"><link rel=canonical href=https://wonyoungseo.github.io/posts/2024-03-08-k8s-multiple-container-pod/><meta name=google-site-verification content="XYZabc"><link href=/assets/css/stylesheet.min.d8cbf60331b9ced42909130bf88f8b97d2eb3de242444dcc9e2df410ceb098b9.css integrity="sha256-2Mv2AzG5ztQpCRML+I+Ll9LrPeJCRE3Mni30EM6wmLk=" rel="preload stylesheet" as=style><link rel=icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="Kubernetes - Multi-Container Pod"><meta property="og:description" content="Multi-Container Pod  (처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님. 그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.  다른 컨테이너를 통해 실행되는 서비스가 메인 어플리케이션을 보조하는 경우 동일 스토리지 또는 네트워크의 공유하는 서비스가 필요한 경우 동일한 라이프사이클을 이루는 경우  생성, 배포, 삭제, 스케일 업다운이 동일하게 적용되어야 하는 경우.   예) 웹서버와 별도로 로깅 서비스가 함께 페어를 이룬 경우   따라서 굳이 별도의 파드에 분리할 필요가 없음."><meta property="og:type" content="article"><meta property="og:url" content="https://wonyoungseo.github.io/posts/2024-03-08-k8s-multiple-container-pod/"><meta property="og:image" content="https://wonyoungseo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:published_time" content="2024-03-08T01:44:13+09:00"><meta property="article:modified_time" content="2024-03-08T01:44:13+09:00"><meta property="og:site_name" content="WY's Tech Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wonyoungseo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Kubernetes - Multi-Container Pod"><meta name=twitter:description content="Multi-Container Pod  (처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님. 그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.  다른 컨테이너를 통해 실행되는 서비스가 메인 어플리케이션을 보조하는 경우 동일 스토리지 또는 네트워크의 공유하는 서비스가 필요한 경우 동일한 라이프사이클을 이루는 경우  생성, 배포, 삭제, 스케일 업다운이 동일하게 적용되어야 하는 경우.   예) 웹서버와 별도로 로깅 서비스가 함께 페어를 이룬 경우   따라서 굳이 별도의 파드에 분리할 필요가 없음."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes - Multi-Container Pod","name":"Kubernetes - Multi-Container Pod","description":"Multi-Container Pod  (처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님. 그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.  다른 컨테이너 …","keywords":["kubernetes","k8s"],"articleBody":"Multi-Container Pod  (처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님. 그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.  다른 컨테이너를 통해 실행되는 서비스가 메인 어플리케이션을 보조하는 경우 동일 스토리지 또는 네트워크의 공유하는 서비스가 필요한 경우 동일한 라이프사이클을 이루는 경우  생성, 배포, 삭제, 스케일 업다운이 동일하게 적용되어야 하는 경우.   예) 웹서버와 별도로 로깅 서비스가 함께 페어를 이룬 경우   따라서 굳이 별도의 파드에 분리할 필요가 없음. 이러한 경우를 Multi-Container Pod 구성 또는 디자인 패턴이라 함.  Multi-Container Pod 생성 방법 Pod를 정의할 때, 컨테이너를 array의 형태로 정의함.\n# example apiVersion: 1 kind: Pod metadata: name: my-webapp labels: name: my-webapp spec: containers: - name: my-webapp image: my-webapp ports: - containerPort: 8080 - name: log-agent image: log-agent Multi-Container Pod Design Pattern Multi-Container Pod 에는 다음과 같은 디자인 패턴이 제시됨.\n   Source: Multi-Container Pod Design Patterns in Kubernetes\n   Sidecar Container  기존 파드의 기능을 보조하고 스토리지 또는 파일시스템을 공유하는 형태의 보조 컨테이너를 사용하는 패턴   Adapter Container  파드에서 실행 중인 애플리케이션의 출력을 특정 형태나 규격에 맞게 표준화하는 용도   Ambassador Container  파드 외부의 서비스에 대한 엑세스를 간소화하는 프록시 컨테이너 유형    Init Container 하나의 파드에 한개 이상의 포드가 정의되는 또다른 유형.\n  Init Container는 실제로 동작할 어플리케이션의 컨테이너가 생성되기 이전에 동작하고 사라질 컨테이너\n 예)  코드를 pull하고 역할만 하는 컨테이너 데이터베이스를 초기 설정하는 컨테이너 (비슷한 예로 Airflow 예제를 보면 컨테이너 실행할 때 init container에서 postgres를 설정하는 부분이 있음)      일반 컨테이너와의 차이점\n 사전 정의한 작업이 완료되면 종료되어야 함. 생명주기 옵션 사용을 사용할 수 없음. 여러 개를 정의한 경우에는 순차적으로 시작되며, 정상 종료되었을 때 다음 Init Container 가 시작됨.  구동이 실패한 경우 재시작하지만, restartPolicy가 Never로 명시되었을 때는 파드 자체의 status가 Failure로 기록되고 종료됨.      Init Container 생성 방법 : initContainers  initContainers 로 정의함. Pod가 생성될 때 initContainer 부터 먼저 실행 되고, 내부 정의된 프로세스가 완료될 때까지 실행됨. 복수개로 정의해도 됨. 위에서부터 아래로 순서대로 실행 됨.  # example apiVersion: v1 kind: Pod metadata: name: myapp-pod labels: app: myapp spec: initContainers: - name: init-myservice image: busybox:1.28 command: ['sh', '-c', 'until nslookup myservice; do echo waiting for myservice; sleep 2; done;'] - name: init-mydb image: busybox:1.28 command: ['sh', '-c', 'until nslookup mydb; do echo waiting for mydb; sleep 2; done;'] containers: - name: myapp-container image: busybox:1.28 command: ['sh', '-c', 'echo The app is running! \u0026\u0026 sleep 3600'] Reference  Multi-Container Pod Design Patterns in Kubernetes  ","wordCount":"384","inLanguage":"en","datePublished":"2024-03-08T01:44:13+09:00","dateModified":"2024-03-08T01:44:13+09:00","author":{"@type":"Person","name":"Wonyoung Seo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wonyoungseo.github.io/posts/2024-03-08-k8s-multiple-container-pod/"},"publisher":{"@type":"Organization","name":"Wonyoung's Tech Blog","logo":{"@type":"ImageObject","url":"https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://wonyoungseo.github.io/ accesskey=h title="Tech Blog (Alt + H)">Tech Blog</a>
<span class=logo-switches><a id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://wonyoungseo.github.io/archives/ title=posts><span>posts</span></a></li><li><a href=https://wonyoungseo.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://wonyoungseo.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wonyoungseo.github.io/about/ title=about><span>about</span></a></li><li><a href=https://wonyoungseo.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Kubernetes - Multi-Container Pod</h1><div class=post-meta>March 8, 2024&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Wonyoung Seo</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#multi-container-pod aria-label="Multi-Container Pod">Multi-Container Pod</a></li><li><a href=#multi-container-pod-%ec%83%9d%ec%84%b1-%eb%b0%a9%eb%b2%95 aria-label="Multi-Container Pod 생성 방법">Multi-Container Pod 생성 방법</a></li><li><a href=#multi-container-pod-design-pattern aria-label="Multi-Container Pod Design Pattern">Multi-Container Pod Design Pattern</a></li><li><a href=#init-container aria-label="Init Container">Init Container</a></li><li><a href=#init-container-%ec%83%9d%ec%84%b1-%eb%b0%a9%eb%b2%95--initcontainers aria-label="Init Container 생성 방법 : initContainers">Init Container 생성 방법 : <code>initContainers</code></a></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h2 id=multi-container-pod>Multi-Container Pod<a hidden class=anchor aria-hidden=true href=#multi-container-pod>#</a></h2><ul><li>(처음 쿠버네티스와 Pod의 개념에 대해 설명할 때) 파드는 최소의 배포단위이기에 여러 개의 어플리케이션 컨테이너를 묶어 하나의 파드로 배포하는 것은 적절한 사용법이 아님.</li><li>그러나, 하나의 파드에 복수의 컨테이너를 함께 구성하여 배포하는 방식이 충분히 고려될 수 있음.<ul><li>다른 컨테이너를 통해 실행되는 서비스가 메인 어플리케이션을 보조하는 경우</li><li>동일 스토리지 또는 네트워크의 공유하는 서비스가 필요한 경우</li><li>동일한 라이프사이클을 이루는 경우<ul><li>생성, 배포, 삭제, 스케일 업다운이 동일하게 적용되어야 하는 경우.</li></ul></li><li>예) 웹서버와 별도로 로깅 서비스가 함께 페어를 이룬 경우</li></ul></li><li>따라서 굳이 별도의 파드에 분리할 필요가 없음.</li><li>이러한 경우를 Multi-Container Pod 구성 또는 디자인 패턴이라 함.</li></ul><h2 id=multi-container-pod-생성-방법>Multi-Container Pod 생성 방법<a hidden class=anchor aria-hidden=true href=#multi-container-pod-생성-방법>#</a></h2><p>Pod를 정의할 때, 컨테이너를 array의 형태로 정의함.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>
<span style=color:#75715e># example</span>

<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-webapp</span>
  <span style=color:#f92672>labels</span>:
	  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-webapp</span>

<span style=color:#f92672>spec</span>:
	<span style=color:#f92672>containers</span>:
	- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-webapp</span>
		<span style=color:#f92672>image</span>: <span style=color:#ae81ff>my-webapp</span>
		<span style=color:#f92672>ports</span>:
			- <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8080</span>
		
	- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>log-agent</span>
		<span style=color:#f92672>image</span>: <span style=color:#ae81ff>log-agent</span>
</code></pre></div><h2 id=multi-container-pod-design-pattern>Multi-Container Pod Design Pattern<a hidden class=anchor aria-hidden=true href=#multi-container-pod-design-pattern>#</a></h2><p>Multi-Container Pod 에는 다음과 같은 디자인 패턴이 제시됨.</p><figure><center><img src=/2024-03-08-k8s-multiple-container-pod/1.png alt="Source: Multi-Container Pod Design Patterns in Kubernetes"></center> <center><figcaption><p>Source: <a href="https://matthewpalmer.net/kubernetes-app-developer/articles/multi-container-pod-design-patterns.html?ref=seongjin.me">Multi-Container Pod Design Patterns in Kubernetes</a></p></figcaption></center></figure><ol><li>Sidecar Container<ul><li>기존 파드의 기능을 보조하고 스토리지 또는 파일시스템을 공유하는 형태의 보조 컨테이너를 사용하는 패턴</li></ul></li><li>Adapter Container<ul><li>파드에서 실행 중인 애플리케이션의 출력을 특정 형태나 규격에 맞게 표준화하는 용도</li></ul></li><li>Ambassador Container<ul><li>파드 외부의 서비스에 대한 엑세스를 간소화하는 프록시 컨테이너 유형</li></ul></li></ol><h2 id=init-container>Init Container<a hidden class=anchor aria-hidden=true href=#init-container>#</a></h2><p>하나의 파드에 한개 이상의 포드가 정의되는 또다른 유형.</p><ul><li><p>Init Container는 실제로 동작할 어플리케이션의 컨테이너가 생성되기 이전에 동작하고 사라질 컨테이너</p><ul><li>예)<ul><li>코드를 pull하고 역할만 하는 컨테이너</li><li>데이터베이스를 초기 설정하는 컨테이너 (비슷한 예로 Airflow 예제를 보면 컨테이너 실행할 때 init container에서 postgres를 설정하는 부분이 있음)</li></ul></li></ul></li><li><p>일반 컨테이너와의 차이점</p><ul><li>사전 정의한 작업이 완료되면 종료되어야 함.</li><li>생명주기 옵션 사용을 사용할 수 없음.</li><li>여러 개를 정의한 경우에는 순차적으로 시작되며, 정상 종료되었을 때 다음 Init Container 가 시작됨.<ul><li>구동이 실패한 경우 재시작하지만, <code>restartPolicy</code>가 <code>Never</code>로 명시되었을 때는 파드 자체의 status가 Failure로 기록되고 종료됨.</li></ul></li></ul></li></ul><h2 id=init-container-생성-방법--initcontainers>Init Container 생성 방법 : <code>initContainers</code><a hidden class=anchor aria-hidden=true href=#init-container-생성-방법--initcontainers>#</a></h2><ul><li><code>initContainers</code> 로 정의함.</li><li>Pod가 생성될 때 initContainer 부터 먼저 실행 되고, 내부 정의된 프로세스가 완료될 때까지 실행됨.</li><li>복수개로 정의해도 됨. 위에서부터 아래로 순서대로 실행 됨.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>
<span style=color:#75715e># example</span>

<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp-pod</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>initContainers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>init-myservice</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:1.28</span>
    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;sh&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;&#39;</span>]
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>init-mydb</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:1.28</span>
    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;sh&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;&#39;</span>]

  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp-container</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:1.28</span>
    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;sh&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;echo The app is running! &amp;&amp; sleep 3600&#39;</span>]

</code></pre></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li><a href="https://matthewpalmer.net/kubernetes-app-developer/articles/multi-container-pod-design-patterns.html?ref=seongjin.me" target=_blank>Multi-Container Pod Design Patterns in Kubernetes</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://wonyoungseo.github.io/tags/kubernetes/>kubernetes</a></li><li><a href=https://wonyoungseo.github.io/tags/k8s/>k8s</a></li></ul></footer></article></main><footer class=footer><span>© Wonyoung Seo 2023</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>