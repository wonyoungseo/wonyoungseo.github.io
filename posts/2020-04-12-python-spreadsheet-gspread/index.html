<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread) | Wonyoung's Tech Blog</title><meta name=keywords content="python,gspread"><meta name=description content="0. Motivation Who&rsquo;s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전달하는 여러 단계와 여러 사람들을 거치다 보니 주고받은 파일명이 뒤죽박죽인 아주 원초(?)적인 문제부터, 데이터가 언제 업데이트 되었는지 추적이 불가능한 상황도 발생하면서 마음 한 켠에 찝찝함이 남아있는 나날이 계속 되었다. 언제 어디선가 불시에 문제가 생기지는 않을까 하는 두려움."><meta name=author content="Wonyoung Seo"><link rel=canonical href=https://wonyoungseo.github.io/posts/2020-04-12-python-spreadsheet-gspread/><meta name=google-site-verification content="XYZabc"><link href=/assets/css/stylesheet.min.d8cbf60331b9ced42909130bf88f8b97d2eb3de242444dcc9e2df410ceb098b9.css integrity="sha256-2Mv2AzG5ztQpCRML+I+Ll9LrPeJCRE3Mni30EM6wmLk=" rel="preload stylesheet" as=style><link rel=icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><meta property="og:title" content="[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread)"><meta property="og:description" content="0. Motivation Who&rsquo;s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전달하는 여러 단계와 여러 사람들을 거치다 보니 주고받은 파일명이 뒤죽박죽인 아주 원초(?)적인 문제부터, 데이터가 언제 업데이트 되었는지 추적이 불가능한 상황도 발생하면서 마음 한 켠에 찝찝함이 남아있는 나날이 계속 되었다. 언제 어디선가 불시에 문제가 생기지는 않을까 하는 두려움."><meta property="og:type" content="article"><meta property="og:url" content="https://wonyoungseo.github.io/posts/2020-04-12-python-spreadsheet-gspread/"><meta property="og:image" content="https://wonyoungseo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:published_time" content="2020-04-12T14:24:01+09:00"><meta property="article:modified_time" content="2020-04-12T14:24:01+09:00"><meta property="og:site_name" content="WY's Tech Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wonyoungseo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread)"><meta name=twitter:description content="0. Motivation Who&rsquo;s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전달하는 여러 단계와 여러 사람들을 거치다 보니 주고받은 파일명이 뒤죽박죽인 아주 원초(?)적인 문제부터, 데이터가 언제 업데이트 되었는지 추적이 불가능한 상황도 발생하면서 마음 한 켠에 찝찝함이 남아있는 나날이 계속 되었다. 언제 어디선가 불시에 문제가 생기지는 않을까 하는 두려움."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread)","name":"[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread)","description":"0. Motivation Who\u0026amp;rsquo;s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전 …","keywords":["python","gspread"],"articleBody":"0. Motivation Who’s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전달하는 여러 단계와 여러 사람들을 거치다 보니 주고받은 파일명이 뒤죽박죽인 아주 원초(?)적인 문제부터, 데이터가 언제 업데이트 되었는지 추적이 불가능한 상황도 발생하면서 마음 한 켠에 찝찝함이 남아있는 나날이 계속 되었다. 언제 어디선가 불시에 문제가 생기지는 않을까 하는 두려움. 하지만 아무도 두려워하지 않는 듯해 보여서 더 두려운 고요한 두려움.\n“대체 언제까지 슬랙으로 엑셀 파일을 주고 받아야 하는가?“에 대한 해답을 찾던 중, 구글 스프레드시트(Google Spreadsheet)와 연동하는 것으로 몇가지 고민을 해결할 수 있게 되었다. gspread라는 라이브러리를 찾게 되었다. 별 거 아닌데, 왜 여태 사용해보지 않았을까. 이거다 싶었다.\n   바로 적용한 아주 간단한 예시를 들자면, 리서쳐들이 구글 스프레드시트에서 작업한 것들을 DB에 적재하는 과정을 자동화할 수 있었고, 데이터를 누가 작업했고, 업데이트가 되었는지에 대한 여부 또한 스프레드시트를 기반으로 작업하게 되니 해결 되었다. Python과 gspread 통해서 구글 스프레드시트와 연동하는 과정을 다룬 사내 튜토리얼을 다시 정리해보았다.\n\u0026nbsp\n1. 튜토리얼 1.1. GCP에서 사용자 인증 설정 Python으로 스프레드시트를 연동하기 위해서는, GCP(Google Cloud Platform)에서 사용자 인증과 API 사용 인증이 준비되어야 한다.\n\u0026nbsp\n1.1.1. 구글 클라우드 플랫폼에 로그인  회사에서는 팀원들과 드라이브를 공유하기에 Gsuite 계정으로 로그인했다.     \u0026nbsp\n1.1.2. 새로운 프로젝트 생성  구글 드라이브, 구글 스프레드시트와 연동할 새로운 프로젝트를 새로 생성한다.              \u0026nbsp\n1.1.3. 구글 드라이브 API 사용 설정  새로 생성한 프로젝트를 선택하고, API 개요 이동하여 구글 드라이브 API 사용을 설정한다.                     \u0026nbsp\n1.1.4. 구글 드라이브 API에 대한 인증정보 생성.  구글 드라이브 API를 사용함에 있어서 필요한 사용자 인증정보를 추가한다. 새 서비스 계정을 만들면, 서비스 계정 및 Key가 JSON 형태의 파일이 받아지게 된다.  특히 추후 파이썬 코드 내에서 Key가 필요하게 되니, 적절한 디렉토리에 저장하도록 한다.                 \u0026nbsp\n1.1.5. 구글 스프레드시트 API 사용 설정  구글 드라이브 API 사용 설정한 방법과 동일하게, 구글 스프레드시트 API 사용설정을 활성화 한다.        \u0026nbsp \u0026nbsp\n1.2. 파이썬 패키지 설치  파이썬에서는 gspread와 oauth2client가 필요하다.  gspread: 파이썬을 통해 구글 스프레드시트와 연동하고, 제어할 수 있게 하는 패키지. oauth2client: OAuth2을 통해 사용자 인증을 하기 위해 설치함.   터미널 또는 CMD에서 pip를 통해 설치하도록 한다.  pip install gspread pip install --upgrade oauth2client \u0026nbsp \u0026nbsp\n1.3. 구글 스프레드시트 파일 설정  파이썬을 통해서 접근하고 연동하고자 하는 해당 구글 시트에서 사용자 인증 정보를 설정하다. 앞서 내려 받은 JSON파일에서 client_email의 값을 복사한 뒤, 해당 스프레드시트 우측 상단 공유를 클릭한 뒤 입력하여 권한을 부여한다..         복잡하지는 않지만, 스프레드시트마다 이 작업을 해주어야 한다는 점이 약간 번거로운 부분이다. 공유 권한부여까지 완료되었다면, 이제 파이썬으로 스프레드시트의 데이터를 읽어와보자!  \u0026nbsp \u0026nbsp\n1.4. 파이썬에서 테스트 1.4.1. 인증과 연동  사용자 인증 파일(JSON)을 통해 연동을 한다.  from oauth2client.service_account import ServiceAccountCredentials scope = [\"https://spreadsheets.google.com/feeds\", \"https://www.googleapis.com/auth/spreadsheets\", \"https://www.googleapis.com/auth/drive.file\", \"https://www.googleapis.com/auth/drive\"] creds = ServiceAccountCredentials.from_json_keyfile_name(\"{your_JSON_filename}.json\", scope) \u0026nbsp\n1.4.2. 스프레드 시트 선택  테스트를 위해서 샘플 스프레드시트를 생성한 상태이다.  빈 시트인 시트1, 그리고 상장기업종목코드와 기업명이 담긴 sample_data 시트가 있다.        gspread 패키지를 통해 인증 후, 접근하고자 하는 시트의 이름을 패스한다.  import gspread spreadsheet_name = \"{your target spreadsheet name}\" client = gspread.authorize(creds) spreadsheet = client.open(spreadsheet_name) \u0026nbsp\n1.4.3. 시트 불러오기 for sheet in spreadsheet.worksheets(): print(sheet) \u0026nbsp\n1.4.4. 시트 선택하기  이름 또는 인덱스를 통해 시트를 선택할 수 있다.  ## by name sheet = spreadsheet.worksheet(\"sample_data\") ## OR by index sheet = spreadsheet.get_worksheet(1) print(sheet) \u0026nbsp\n1.4.5. 시트 내 데이터 읽어오기  get_all_values() 함수는 시트 내 데이터를 모두 출력한다.  sheet.get_all_records()[:3] [{'CompanyStockCode': 'S030190', 'PA_CompanyID': 1, 'IA_CompanyID': 'ID00001', 'DelistStatus': '', 'CompanyKorName': 'NICE평가정보'}, {'CompanyStockCode': 'S038620', 'PA_CompanyID': 2, 'IA_CompanyID': 'ID00002', 'DelistStatus': '', 'CompanyKorName': '위즈코프'}, {'CompanyStockCode': 'S039020', 'PA_CompanyID': 3, 'IA_CompanyID': 'ID00003', 'DelistStatus': '', 'CompanyKorName': '이건홀딩스'}] \u0026nbsp\n1.4.6. Pandas DataFrame 형태로 변환  간단한 함수를 작성하여 Pandas의 DataFrame형태로 데이터를 불러올 수 있다.  def gsheet2df(sheet): df = pd.DataFrame(columns=list(sheet.get_all_records()[0].keys())) for item in sheet.get_all_records(): df.loc[len(df)] = item return df df_sample_data = gsheet2df(sheet) df_sample_data.head()    \u0026nbsp \u0026nbsp\n2. 마무리하며 리서쳐와 데이터를 주고 받으며 일하던 와중에, gspread의 적용은 매우 빛과 소금 같은 시원한, 그리고 매우 신속했던 해결책이었다. 내 업무영역에 적용한 뒤, 바로 다른 분석가 동료들에게 튜토리얼을 통해 공유하는 세션을 가지기도 했던 만큼 적용되는 범위가 컸다.\n누구든 일을 하다 잠재적인 기술 부채를 맞닥뜨리면, 미래의 나를 위해서 어떻게든 털어내버리고 싶을 것이다. 하지만, 함께 해결해나갈 인력이 없는 환경에서 비개발자인 동료들도 불편해하지 않게끔 적절한 방법을 찾고 도입하는 것은 생각보다 쉽지 않았다. 답답할 때가 없지는 않지만, 이번 케이스처럼 또 하나하나씩 도입해나가면 더 매끄러워지지 않을까라는 생각을 해보며 또 다른 기술 부채를 맞닥뜨릴 마음의 준비를 해본다.\n\u0026nbsp\n 3. Reference   gspread 공식 도큐먼트\n  Manage Google Spreadsheets with Python and Gspread\n  ","wordCount":"692","inLanguage":"en","datePublished":"2020-04-12T14:24:01+09:00","dateModified":"2020-04-12T14:24:01+09:00","author":{"@type":"Person","name":"Wonyoung Seo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wonyoungseo.github.io/posts/2020-04-12-python-spreadsheet-gspread/"},"publisher":{"@type":"Organization","name":"Wonyoung's Tech Blog","logo":{"@type":"ImageObject","url":"https://wonyoungseo.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://wonyoungseo.github.io/ accesskey=h title="Tech Blog (Alt + H)">Tech Blog</a>
<span class=logo-switches><a id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://wonyoungseo.github.io/archives/ title=posts><span>posts</span></a></li><li><a href=https://wonyoungseo.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://wonyoungseo.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wonyoungseo.github.io/about/ title=about><span>about</span></a></li><li><a href=https://wonyoungseo.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>[KR] Python으로 구글 스프레드시트 연동하기 (ft. gspread)</h1><div class=post-meta>April 12, 2020&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Wonyoung Seo</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#0-motivation aria-label="0. Motivation">0. Motivation</a></li><li><a href=#1-%ed%8a%9c%ed%86%a0%eb%a6%ac%ec%96%bc aria-label="1. 튜토리얼">1. 튜토리얼</a><ul><li><a href=#11-gcp%ec%97%90%ec%84%9c-%ec%82%ac%ec%9a%a9%ec%9e%90-%ec%9d%b8%ec%a6%9d-%ec%84%a4%ec%a0%95 aria-label="1.1. GCP에서 사용자 인증 설정">1.1. GCP에서 사용자 인증 설정</a><ul><li><a href=#111-%ea%b5%ac%ea%b8%80-%ed%81%b4%eb%9d%bc%ec%9a%b0%eb%93%9c-%ed%94%8c%eb%9e%ab%ed%8f%bc%ec%97%90-%eb%a1%9c%ea%b7%b8%ec%9d%b8 aria-label="1.1.1. 구글 클라우드 플랫폼에 로그인">1.1.1. 구글 클라우드 플랫폼에 로그인</a></li><li><a href=#112-%ec%83%88%eb%a1%9c%ec%9a%b4-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ec%83%9d%ec%84%b1 aria-label="1.1.2. 새로운 프로젝트 생성">1.1.2. 새로운 프로젝트 생성</a></li><li><a href=#113-%ea%b5%ac%ea%b8%80-%eb%93%9c%eb%9d%bc%ec%9d%b4%eb%b8%8c-api-%ec%82%ac%ec%9a%a9-%ec%84%a4%ec%a0%95 aria-label="1.1.3. 구글 드라이브 API 사용 설정">1.1.3. 구글 드라이브 API 사용 설정</a></li><li><a href=#114-%ea%b5%ac%ea%b8%80-%eb%93%9c%eb%9d%bc%ec%9d%b4%eb%b8%8c-api%ec%97%90-%eb%8c%80%ed%95%9c-%ec%9d%b8%ec%a6%9d%ec%a0%95%eb%b3%b4-%ec%83%9d%ec%84%b1 aria-label="1.1.4. 구글 드라이브 API에 대한 인증정보 생성.">1.1.4. 구글 드라이브 API에 대한 인증정보 생성.</a></li><li><a href=#115-%ea%b5%ac%ea%b8%80-%ec%8a%a4%ed%94%84%eb%a0%88%eb%93%9c%ec%8b%9c%ed%8a%b8-api-%ec%82%ac%ec%9a%a9-%ec%84%a4%ec%a0%95 aria-label="1.1.5. 구글 스프레드시트 API 사용 설정">1.1.5. 구글 스프레드시트 API 사용 설정</a></li></ul></li><li><a href=#12-%ed%8c%8c%ec%9d%b4%ec%8d%ac-%ed%8c%a8%ed%82%a4%ec%a7%80-%ec%84%a4%ec%b9%98 aria-label="1.2. 파이썬 패키지 설치">1.2. 파이썬 패키지 설치</a></li><li><a href=#13-%ea%b5%ac%ea%b8%80-%ec%8a%a4%ed%94%84%eb%a0%88%eb%93%9c%ec%8b%9c%ed%8a%b8-%ed%8c%8c%ec%9d%bc-%ec%84%a4%ec%a0%95 aria-label="1.3. 구글 스프레드시트 파일 설정">1.3. 구글 스프레드시트 파일 설정</a></li><li><a href=#14-%ed%8c%8c%ec%9d%b4%ec%8d%ac%ec%97%90%ec%84%9c-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label="1.4. 파이썬에서 테스트">1.4. 파이썬에서 테스트</a><ul><li><a href=#141-%ec%9d%b8%ec%a6%9d%ea%b3%bc-%ec%97%b0%eb%8f%99 aria-label="1.4.1. 인증과 연동">1.4.1. 인증과 연동</a></li><li><a href=#142-%ec%8a%a4%ed%94%84%eb%a0%88%eb%93%9c-%ec%8b%9c%ed%8a%b8-%ec%84%a0%ed%83%9d aria-label="1.4.2. 스프레드 시트 선택">1.4.2. 스프레드 시트 선택</a></li><li><a href=#143-%ec%8b%9c%ed%8a%b8-%eb%b6%88%eb%9f%ac%ec%98%a4%ea%b8%b0 aria-label="1.4.3. 시트 불러오기">1.4.3. 시트 불러오기</a></li><li><a href=#144-%ec%8b%9c%ed%8a%b8-%ec%84%a0%ed%83%9d%ed%95%98%ea%b8%b0 aria-label="1.4.4. 시트 선택하기">1.4.4. 시트 선택하기</a></li><li><a href=#145-%ec%8b%9c%ed%8a%b8-%eb%82%b4-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%9d%bd%ec%96%b4%ec%98%a4%ea%b8%b0 aria-label="1.4.5. 시트 내 데이터 읽어오기">1.4.5. 시트 내 데이터 읽어오기</a></li><li><a href=#146-pandas-dataframe-%ed%98%95%ed%83%9c%eb%a1%9c-%eb%b3%80%ed%99%98 aria-label="1.4.6. Pandas DataFrame 형태로 변환">1.4.6. Pandas DataFrame 형태로 변환</a></li></ul></li></ul></li><li><a href=#2-%eb%a7%88%eb%ac%b4%eb%a6%ac%ed%95%98%eb%a9%b0 aria-label="2. 마무리하며">2. 마무리하며</a></li><li><a href=#3-reference aria-label="3. Reference">3. Reference</a></li></ul></div></details></div><div class=post-content><h1 id=0-motivation>0. Motivation<a hidden class=anchor aria-hidden=true href=#0-motivation>#</a></h1><p>Who&rsquo;s Good에서는 ESG리서쳐와 분석가/개발자 간에 데이터를 주고 받는 일이 매우 빈번하다. 특히 기업 관련 뉴스 데이터와, 다양한 소스로부터 수집하는 ESG 관련 데이터에 대한 QC를 진행하고 결과를 DB에 적재하는 과정이 있다. 엑셀에서 작업한 데이터를 저장하고, 슬랙으로 전달하는 여러 단계와 여러 사람들을 거치다 보니 주고받은 파일명이 뒤죽박죽인 아주 원초(?)적인 문제부터, 데이터가 언제 업데이트 되었는지 추적이 불가능한 상황도 발생하면서 마음 한 켠에 찝찝함이 남아있는 나날이 계속 되었다. 언제 어디선가 불시에 문제가 생기지는 않을까 하는 두려움. 하지만 아무도 두려워하지 않는 듯해 보여서 더 두려운 고요한 두려움.</p><p>&ldquo;대체 언제까지 슬랙으로 엑셀 파일을 주고 받아야 하는가?&ldquo;에 대한 해답을 찾던 중, 구글 스프레드시트(Google Spreadsheet)와 연동하는 것으로 몇가지 고민을 해결할 수 있게 되었다. <strong>gspread</strong>라는 라이브러리를 찾게 되었다. 별 거 아닌데, 왜 여태 사용해보지 않았을까. 이거다 싶었다.</p><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/1.png></center></figure><p>바로 적용한 아주 간단한 예시를 들자면, 리서쳐들이 구글 스프레드시트에서 작업한 것들을 DB에 적재하는 과정을 자동화할 수 있었고, 데이터를 누가 작업했고, 업데이트가 되었는지에 대한 여부 또한 스프레드시트를 기반으로 작업하게 되니 해결 되었다. Python과 <strong>gspread</strong> 통해서 구글 스프레드시트와 연동하는 과정을 다룬 사내 튜토리얼을 다시 정리해보았다.</p><p>&nbsp</p><h1 id=1-튜토리얼>1. 튜토리얼<a hidden class=anchor aria-hidden=true href=#1-튜토리얼>#</a></h1><h2 id=11-gcp에서-사용자-인증-설정>1.1. GCP에서 사용자 인증 설정<a hidden class=anchor aria-hidden=true href=#11-gcp에서-사용자-인증-설정>#</a></h2><p>Python으로 스프레드시트를 연동하기 위해서는, GCP(Google Cloud Platform)에서 사용자 인증과 API 사용 인증이 준비되어야 한다.</p><p>&nbsp</p><h3 id=111-구글-클라우드-플랫폼에-로그인>1.1.1. 구글 클라우드 플랫폼에 로그인<a hidden class=anchor aria-hidden=true href=#111-구글-클라우드-플랫폼에-로그인>#</a></h3><ul><li>회사에서는 팀원들과 드라이브를 공유하기에 Gsuite 계정으로 로그인했다.</li></ul><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/2.png></center></figure><p>&nbsp</p><h3 id=112-새로운-프로젝트-생성>1.1.2. 새로운 프로젝트 생성<a hidden class=anchor aria-hidden=true href=#112-새로운-프로젝트-생성>#</a></h3><ul><li>구글 드라이브, 구글 스프레드시트와 연동할 새로운 프로젝트를 새로 생성한다.</li></ul><p><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/3.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/4.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/5.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/6.png></center></figure></p><p>&nbsp</p><h3 id=113-구글-드라이브-api-사용-설정>1.1.3. 구글 드라이브 API 사용 설정<a hidden class=anchor aria-hidden=true href=#113-구글-드라이브-api-사용-설정>#</a></h3><ul><li>새로 생성한 프로젝트를 선택하고, API 개요 이동하여 구글 드라이브 API 사용을 설정한다.<figure><center><img src=/2020-04-12-python-spreadsheet-gspread/7.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/8.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/9.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/10.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/11.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/12.png></center></figure></li></ul><p>&nbsp</p><h3 id=114-구글-드라이브-api에-대한-인증정보-생성>1.1.4. 구글 드라이브 API에 대한 인증정보 생성.<a hidden class=anchor aria-hidden=true href=#114-구글-드라이브-api에-대한-인증정보-생성>#</a></h3><ul><li>구글 드라이브 API를 사용함에 있어서 필요한 사용자 인증정보를 추가한다.</li><li>새 서비스 계정을 만들면, 서비스 계정 및 Key가 JSON 형태의 파일이 받아지게 된다.<ul><li>특히 추후 파이썬 코드 내에서 Key가 필요하게 되니, 적절한 디렉토리에 저장하도록 한다.<figure><center><img src=/2020-04-12-python-spreadsheet-gspread/13.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/14.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/15.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/16.png></center></figure></li></ul></li></ul><p>&nbsp</p><h3 id=115-구글-스프레드시트-api-사용-설정>1.1.5. 구글 스프레드시트 API 사용 설정<a hidden class=anchor aria-hidden=true href=#115-구글-스프레드시트-api-사용-설정>#</a></h3><ul><li>구글 드라이브 API 사용 설정한 방법과 동일하게, 구글 스프레드시트 API 사용설정을 활성화 한다.</li></ul><p><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/17.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/18.png></center></figure></p><p>&nbsp
&nbsp</p><h2 id=12-파이썬-패키지-설치>1.2. 파이썬 패키지 설치<a hidden class=anchor aria-hidden=true href=#12-파이썬-패키지-설치>#</a></h2><ul><li>파이썬에서는 <code>gspread</code>와 <code>oauth2client</code>가 필요하다.<ul><li><code>gspread</code>: 파이썬을 통해 구글 스프레드시트와 연동하고, 제어할 수 있게 하는 패키지.</li><li><code>oauth2client</code>: OAuth2을 통해 사용자 인증을 하기 위해 설치함.</li></ul></li><li>터미널 또는 CMD에서 pip를 통해 설치하도록 한다.</li></ul><pre><code>pip install gspread
pip install --upgrade oauth2client
</code></pre><p>&nbsp
&nbsp</p><h2 id=13-구글-스프레드시트-파일-설정>1.3. 구글 스프레드시트 파일 설정<a hidden class=anchor aria-hidden=true href=#13-구글-스프레드시트-파일-설정>#</a></h2><ul><li>파이썬을 통해서 접근하고 연동하고자 하는 해당 구글 시트에서 사용자 인증 정보를 설정하다.</li><li>앞서 내려 받은 JSON파일에서 <code>client_email</code>의 값을 복사한 뒤, 해당 스프레드시트 우측 상단 <code>공유</code>를 클릭한 뒤 입력하여 권한을 부여한다..</li></ul><p><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/19.png></center></figure><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/20.png></center></figure></p><ul><li>복잡하지는 않지만, 스프레드시트마다 이 작업을 해주어야 한다는 점이 약간 번거로운 부분이다.</li><li>공유 권한부여까지 완료되었다면, 이제 파이썬으로 스프레드시트의 데이터를 읽어와보자!</li></ul><p>&nbsp
&nbsp</p><h2 id=14-파이썬에서-테스트>1.4. 파이썬에서 테스트<a hidden class=anchor aria-hidden=true href=#14-파이썬에서-테스트>#</a></h2><h3 id=141-인증과-연동>1.4.1. 인증과 연동<a hidden class=anchor aria-hidden=true href=#141-인증과-연동>#</a></h3><ul><li>사용자 인증 파일(<code>JSON</code>)을 통해 연동을 한다.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> oauth2client.service_account <span style=color:#f92672>import</span> ServiceAccountCredentials

scope <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://spreadsheets.google.com/feeds&#34;</span>,
         <span style=color:#e6db74>&#34;https://www.googleapis.com/auth/spreadsheets&#34;</span>,
         <span style=color:#e6db74>&#34;https://www.googleapis.com/auth/drive.file&#34;</span>,
         <span style=color:#e6db74>&#34;https://www.googleapis.com/auth/drive&#34;</span>]

creds <span style=color:#f92672>=</span> ServiceAccountCredentials<span style=color:#f92672>.</span>from_json_keyfile_name(<span style=color:#e6db74>&#34;{your_JSON_filename}.json&#34;</span>, scope)
</code></pre></div><p>&nbsp</p><h3 id=142-스프레드-시트-선택>1.4.2. 스프레드 시트 선택<a hidden class=anchor aria-hidden=true href=#142-스프레드-시트-선택>#</a></h3><ul><li>테스트를 위해서 샘플 스프레드시트를 생성한 상태이다.<ul><li>빈 시트인 <code>시트1</code>, 그리고 상장기업종목코드와 기업명이 담긴 <code>sample_data</code> 시트가 있다.</li></ul></li></ul><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/21.png></center></figure><ul><li><code>gspread</code> 패키지를 통해 인증 후, 접근하고자 하는 시트의 이름을 패스한다.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> gspread

spreadsheet_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;{your target spreadsheet name}&#34;</span>
client <span style=color:#f92672>=</span> gspread<span style=color:#f92672>.</span>authorize(creds)
spreadsheet <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>open(spreadsheet_name)
</code></pre></div><p>&nbsp</p><h3 id=143-시트-불러오기>1.4.3. 시트 불러오기<a hidden class=anchor aria-hidden=true href=#143-시트-불러오기>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>for</span> sheet <span style=color:#f92672>in</span> spreadsheet<span style=color:#f92672>.</span>worksheets():
    <span style=color:#66d9ef>print</span>(sheet)
</code></pre></div><pre><code class=language-plain_text data-lang=plain_text>&lt;Worksheet '시트1' id:1966713574&gt;
&lt;Worksheet 'sample_data' id:0&gt;
</code></pre><p>&nbsp</p><h3 id=144-시트-선택하기>1.4.4. 시트 선택하기<a hidden class=anchor aria-hidden=true href=#144-시트-선택하기>#</a></h3><ul><li>이름 또는 인덱스를 통해 시트를 선택할 수 있다.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>## by name</span>
sheet <span style=color:#f92672>=</span> spreadsheet<span style=color:#f92672>.</span>worksheet(<span style=color:#e6db74>&#34;sample_data&#34;</span>)

<span style=color:#75715e>## OR by index</span>
sheet <span style=color:#f92672>=</span> spreadsheet<span style=color:#f92672>.</span>get_worksheet(<span style=color:#ae81ff>1</span>)
<span style=color:#66d9ef>print</span>(sheet)
</code></pre></div><pre><code class=language-plain_text data-lang=plain_text>&lt;Worksheet 'sample_data' id:0&gt;
</code></pre><p>&nbsp</p><h3 id=145-시트-내-데이터-읽어오기>1.4.5. 시트 내 데이터 읽어오기<a hidden class=anchor aria-hidden=true href=#145-시트-내-데이터-읽어오기>#</a></h3><ul><li><code>get_all_values()</code> 함수는 시트 내 데이터를 모두 출력한다.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>sheet<span style=color:#f92672>.</span>get_all_records()[:<span style=color:#ae81ff>3</span>]
</code></pre></div><pre><code class=language-plain_text data-lang=plain_text>[{'CompanyStockCode': 'S030190',
  'PA_CompanyID': 1,
  'IA_CompanyID': 'ID00001',
  'DelistStatus': '',
  'CompanyKorName': 'NICE평가정보'},
 {'CompanyStockCode': 'S038620',
  'PA_CompanyID': 2,
  'IA_CompanyID': 'ID00002',
  'DelistStatus': '',
  'CompanyKorName': '위즈코프'},
 {'CompanyStockCode': 'S039020',
  'PA_CompanyID': 3,
  'IA_CompanyID': 'ID00003',
  'DelistStatus': '',
  'CompanyKorName': '이건홀딩스'}]
</code></pre><p>&nbsp</p><h3 id=146-pandas-dataframe-형태로-변환>1.4.6. Pandas DataFrame 형태로 변환<a hidden class=anchor aria-hidden=true href=#146-pandas-dataframe-형태로-변환>#</a></h3><ul><li>간단한 함수를 작성하여 Pandas의 DataFrame형태로 데이터를 불러올 수 있다.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gsheet2df</span>(sheet):
    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(columns<span style=color:#f92672>=</span>list(sheet<span style=color:#f92672>.</span>get_all_records()[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>keys()))
    <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> sheet<span style=color:#f92672>.</span>get_all_records():
        df<span style=color:#f92672>.</span>loc[len(df)] <span style=color:#f92672>=</span> item
    <span style=color:#66d9ef>return</span> df

df_sample_data <span style=color:#f92672>=</span> gsheet2df(sheet)
df_sample_data<span style=color:#f92672>.</span>head()
</code></pre></div><figure><center><img src=/2020-04-12-python-spreadsheet-gspread/22.png></center></figure><p>&nbsp
&nbsp</p><h1 id=2-마무리하며>2. 마무리하며<a hidden class=anchor aria-hidden=true href=#2-마무리하며>#</a></h1><p>리서쳐와 데이터를 주고 받으며 일하던 와중에, <code>gspread</code>의 적용은 매우 빛과 소금 같은 시원한, 그리고 매우 신속했던 해결책이었다. 내 업무영역에 적용한 뒤, 바로 다른 분석가 동료들에게 튜토리얼을 통해 공유하는 세션을 가지기도 했던 만큼 적용되는 범위가 컸다.</p><p>누구든 일을 하다 잠재적인 기술 부채를 맞닥뜨리면, 미래의 나를 위해서 어떻게든 털어내버리고 싶을 것이다. 하지만, 함께 해결해나갈 인력이 없는 환경에서 비개발자인 동료들도 불편해하지 않게끔 적절한 방법을 찾고 도입하는 것은 생각보다 쉽지 않았다. 답답할 때가 없지는 않지만, 이번 케이스처럼 또 하나하나씩 도입해나가면 더 매끄러워지지 않을까라는 생각을 해보며 또 다른 기술 부채를 맞닥뜨릴 마음의 준비를 해본다.</p><p>&nbsp</p><hr><h1 id=3-reference>3. Reference<a hidden class=anchor aria-hidden=true href=#3-reference>#</a></h1><ul><li><p><a href=https://gspread.readthedocs.io/en/latest/ target=_blank>gspread 공식 도큐먼트</a></p></li><li><p><a href=https://medium.com/@CROSP/manage-google-spreadsheets-with-python-and-gspread-6530cc9f15d1 target=_blank>Manage Google Spreadsheets with Python and Gspread</a></p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://wonyoungseo.github.io/tags/python/>python</a></li><li><a href=https://wonyoungseo.github.io/tags/gspread/>gspread</a></li></ul></footer></article></main><footer class=footer><span>© Wonyoung Seo 2023</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>